<?php
/**
 * Generated by Haxe 4.0.0-rc.3+e3df7a4
 */

namespace tink\streams;

use \tink\core\_Future\SyncFuture;
use \tink\core\_Lazy\LazyObject;
use \php\Boot;
use \tink\core\_Lazy\LazyConst;
use \tink\core\_Future\FutureObject;

class Single extends StreamBase {
	/**
	 * @var LazyObject
	 */
	public $value;

	/**
	 * @param LazyObject $value
	 * 
	 * @return void
	 */
	public function __construct ($value) {
		#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:457: characters 5-23
		parent::__construct();
		$this->value = $value;
	}

	/**
	 * @param \Closure $handle
	 * 
	 * @return FutureObject
	 */
	public function forEach ($handle) {
		#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:462: lines 462-472
		$_gthis = $this;
		#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:463: lines 463-472
		return $handle($this->value->get())->map(function ($step)  use (&$_gthis) {
			$__hx__switch = ($step->index);
			if ($__hx__switch === 0) {
				#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:465: characters 9-21
				return Conclusion::Halted($_gthis);
			} else if ($__hx__switch === 1) {
				#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:467: characters 9-29
				return Conclusion::Halted(Empty_hx::$inst);
			} else if ($__hx__switch === 2) {
				#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:469: characters 9-17
				return Conclusion::Depleted();
			} else if ($__hx__switch === 3) {
				#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:471: characters 9-25
				return Conclusion::Clogged($step->params[0], $_gthis);
			}
		})->gather();
	}

	/**
	 * @return FutureObject
	 */
	public function next () {
		#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:460: characters 29-40
		$v = $this->value->get();
		#/home/grabli66/haxelib/tink_streams/git/src/tink/streams/Stream.hx:460: characters 12-56
		return new SyncFuture(new LazyConst(Step::Link($v, Empty_hx::$inst)));
	}
}

Boot::registerClass(Single::class, 'tink.streams.Single');
